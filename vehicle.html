  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link
        rel="shortcut icon"
        href="assets/images/favicon.svg"
        type="image/x-icon"
      />
      <title>Vehicle Management | Embedded System</title>

      <!-- ========== All CSS files linkup ========= -->
      <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
      <link
        rel="stylesheet"
        href="assets/css/lineicons.css"
        rel="stylesheet"
        type="text/css"
      />
      <link
        rel="stylesheet"
        href="assets/css/materialdesignicons.min.css"
        rel="stylesheet"
        type="text/css"
      />
      <link rel="stylesheet" href="assets/css/fullcalendar.css" />
      <link rel="stylesheet" href="assets/css/fullcalendar.css" />
      <link rel="stylesheet" href="assets/css/main.css" />
      <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
      <script src="noti.js"></script>
      <script src="notification.js"></script>
      <style>
        /* Custom table styles */
        .datatable {
          width: 100%;
          overflow-x: auto;
          margin: 20px 0;
        }

        #vehicleTable {
          width: 100%;
          border-collapse: collapse;
          margin: 0;
          padding: 0;
          font-size: 14px;
        }

        #vehicleTable thead th {
          background-color: #f8f9fa;
          color: #495057;
          font-weight: 600;
          text-align: left;
          padding: 12px 15px;
          border-bottom: 2px solid #dee2e6;
          position: relative;
          cursor: pointer;
        }

        #vehicleTable tbody tr {
          border-bottom: 1px solid #dee2e6;
          transition: all 0.3s;
        }

        #vehicleTable tbody tr:hover {
          background-color: #f8f9fa;
        }

        #vehicleTable tbody td {
          padding: 12px 15px;
          vertical-align: middle;
        }

        #vehicleTable tbody tr:nth-child(even) {
          background-color: #f8f9fa;
        }
        table th,
        table td {
          text-align: center !important;
          vertical-align: middle !important;
        }

        /* Sorting arrows */
        .th-sm.sorting::after {
          content: "‚áÖ";
          position: absolute;
          right: 8px;
          font-size: 12px;
          opacity: 0.5;
        }

        .th-sm.sorting.asc::after {
          content: "‚Üë";
          opacity: 1;
        }

        .th-sm.sorting.desc::after {
          content: "‚Üì";
          opacity: 1;
        }

        /* Pagination styles */
        .pagination-container {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 20px;
        }

        .pagination {
          display: flex;
          list-style: none;
          padding: 0;
          margin: 0;
        }

        .page-item {
          margin: 0 5px;
        }

        .page-link {
          padding: 6px 12px;
          border: 1px solid #dee2e6;
          background-color: #fff;
          color: #007bff;
          cursor: pointer;
          border-radius: 4px;
          transition: all 0.3s;
        }

        .page-link:hover {
          background-color: #e9ecef;
          border-color: #dee2e6;
        }

        .page-item.active .page-link {
          background-color: #007bff;
          border-color: #007bff;
          color: #fff;
        }

        .page-item.disabled .page-link {
          color: #6c757d;
          pointer-events: none;
          background-color: #fff;
          border-color: #dee2e6;
        }

        .page-info {
          color: #6c757d;
          font-size: 14px;
        }

        .rows-per-page {
          display: flex;
          align-items: center;
        }

        .rows-per-page select {
          margin-left: 10px;
          padding: 5px;
          border-radius: 4px;
          border: 1px solid #ced4da;
        }

        /* Status badge styles */
        .badge {
          display: inline-block;
          padding: 5px 10px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          text-transform: uppercase;
        }

        .badge-available {
          background-color: #28a745;
          color: white;
        }

        .badge-running {
          background-color: #25bea3;
          color: white;
        }

        .badge-unavailable {
          background-color: #dc3545;
          color: white;
        }
        /* Th√™m v√†o ph·∫ßn <style> trong head */
        .pagination-container {
          font-family: "Roboto", sans-serif; /* C√≥ th·ªÉ thay b·∫±ng font b·∫°n mu·ªën */
          font-size: 14px; /* K√≠ch th∆∞·ªõc font */
        }

        .page-info {
          font-size: 14px;
          font-weight: 500; /* ƒê·ªô ƒë·∫≠m */
          color: #495057; /* M√†u ch·ªØ */
        }

        .page-link {
          font-size: 14px;
          font-weight: 500;
        }

        .rows-per-page {
          font-size: 14px;
          font-weight: 500;
          color: #495057;
        }
        /* M√†u xanh */
        .tr-selected-blue {
          background-color: #e6f7ff !important;
          box-shadow: inset 0 0 0 1px #1890ff;
        }

        /* M√†u v√†ng */
        .tr-selected-yellow {
          background-color: #fff8e6 !important;
          box-shadow: inset 0 0 0 1px #ffc53d;
        }

        /* M√†u t√≠m */
        .tr-selected-purple {
          background-color: #f9f0ff !important;
          box-shadow: inset 0 0 0 1px #722ed1;
        }
        .dropdown-toggle::after {
          display: none !important;
        }
        /* Modal styles */
        .modal-header {
          padding: 1rem;
          border-bottom: 1px solid #dee2e6;
        }

        .modal-title {
          margin: 0;
          font-size: 1.25rem;
        }

        .modal-body {
          padding: 1rem;
        }

        .modal-footer {
          padding: 1rem;
          border-top: 1px solid #dee2e6;
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
        }

        .form-label {
          font-weight: 500;
          margin-bottom: 0.5rem;
          display: block;
        }

        .form-control,
        .form-select {
          width: 100%;
          padding: 0.375rem 0.75rem;
          border: 1px solid #ced4da;
          border-radius: 0.25rem;
          margin-bottom: 1rem;
        }

        .btn {
          padding: 0.375rem 0.75rem;
          border-radius: 0.25rem;
          cursor: pointer;
        }

        .btn-secondary {
          background-color: #6c757d;
          color: white;
          border: none;
        }

        .btn-primary {
          background-color: #0d6efd;
          color: white;
          border: none;
        }
        .remove-btn:active {
          background-color: #f0f0f0; /* m√†u n·ªÅn khi click */
          color: #333; /* m√†u ch·ªØ khi click */
        }
      </style>
    </head>
    <body>
      <!-- ======== Preloader =========== -->
      <div id="preloader">
        <div class="spinner"></div>
      </div>
      <!-- ======== Preloader =========== -->

      <!-- ======== sidebar-nav start =========== -->
      <div id="sidebar"></div>

      <div class="overlay"></div>
      <!-- ======== sidebar-nav end =========== -->

      <!-- ======== main-wrapper start =========== -->
      <main class="main-wrapper">
        <!-- ========== header start ========== -->
        <div id="header"></div>

        <section class="section">
          <div class="container-fluid">
            <div class="title-wrapper pt-30" style="padding-bottom: 0">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <div class="title" style="margin-bottom: 0">
                    <h2 style="margin-bottom: 0">Vehicle Management</h2>
                  </div>
                </div>
              </div>
            </div>
            <div class="row justify-content-end mb-3">
              <div class="col-auto">
                <button
                  type="button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#addVehicleModal"
                >
                  Add New Vehicle
                </button>
              </div>
            </div>
            <!-- Add Vehicle Modal -->
            <div
              class="modal fade"
              id="addVehicleModal"
              tabindex="-1"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Add New Vehicle</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <form id="vehicleForm">
                      <div class="mb-3">
                        <label for="licensePlate" class="form-label"
                          >License Plate</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="licensePlate"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <label for="vehicleModel" class="form-label">Model</label>
                        <input
                          type="text"
                          class="form-control"
                          id="vehicleModel"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <label for="vehicleStatus" class="form-label"
                          >Status</label
                        >
                        <select class="form-select" id="vehicleStatus" required>
                          <option value="AVAILABLE">Available</option>
                          <option value="RUNNING">Running</option>
                          <option value="UNAVAILABLE">Unavailable</option>
                        </select>
                      </div>
                    </form>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                    <button
                      type="button"
                      class="btn btn-primary"
                      id="saveVehicleBtn"
                    >
                      Save
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- Edit Vehicle Modal -->
            <div
              class="modal fade"
              id="editVehicleModal"
              tabindex="-1"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Edit Vehicle</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <form id="editVehicleForm">
                      <input type="hidden" id="editVehicleId" />
                      <div class="mb-3">
                        <label for="vehicleId" class="form-label">ID</label>
                        <input
                          type="text"
                          class="form-control"
                          id="vehicleId"
                          readonly
                        />
                      </div>

                      <div class="mb-3">
                        <label for="editLicensePlate" class="form-label"
                          >License Plate</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="editLicensePlate"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <label for="editVehicleModel" class="form-label"
                          >Model</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="editVehicleModel"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <label for="editVehicleStatus" class="form-label"
                          >Status</label
                        >
                        <select
                          class="form-select"
                          id="editVehicleStatus"
                          required
                        >
                          <option value="AVAILABLE">Available</option>
                          <option value="RUNNING">Running</option>
                          <option value="UNAVAILABLE">Unavailable</option>
                        </select>
                      </div>
                    </form>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                    <button
                      type="button"
                      class="btn btn-primary"
                      id="updateVehicleBtn"
                    >
                      Update
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div data-mdb-datatable-init class="datatable">
              <table id="vehicleTable">
                <thead>
                  <tr>
                    <th class="th-sm">Vehicle ID</th>
                    <th class="th-sm">License Plate</th>
                    <th class="th-sm">Model</th>
                    <th class="th-sm">Status</th>
                    <th class="th-sm">Actions</th>
                  </tr>
                </thead>
                <tbody id="tableBody">
                  <!-- Data will be inserted here by JavaScript -->
                </tbody>
              </table>

              <!-- Pagination controls -->
              <div class="pagination-container">
                <div class="rows-per-page">
                  <span>Rows per page:</span>
                  <select id="rowsPerPage">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </div>

                <!-- <div class="page-info" id="pageInfo"></div> -->

                <ul class="pagination" id="pagination">
                  <!-- Pagination buttons will be inserted here by JavaScript -->
                </ul>
              </div>
            </div>
          </div>
        </section>
      </main>
      <!-- ======== main-wrapper end =========== -->

      <!-- ========= All Javascript files linkup ======== -->
      <script src="assets/js/bootstrap.bundle.min.js"></script>
      <script src="assets/js/Chart.min.js"></script>
      <script src="assets/js/dynamic-pie-chart.js"></script>
      <script src="assets/js/moment.min.js"></script>
      <script src="assets/js/fullcalendar.js"></script>
      <script src="assets/js/jvectormap.min.js"></script>
      <script src="assets/js/world-merc.js"></script>
      <script src="assets/js/polyfill.js"></script>
      <script src="assets/js/main.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          initializeNotifications();
        });
      </script>
      <script>
        const rowsPerPageSelect = document.getElementById("rowsPerPage");

        // L·∫•y gi√° tr·ªã hi·ªán t·∫°i
        const pageSize = parseInt(rowsPerPageSelect.value);
        console.log("Rows per page:", pageSize);

        // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi (n·∫øu c·∫ßn)
        rowsPerPageSelect.addEventListener("change", () => {
          const newPageSize = parseInt(rowsPerPageSelect.value);
          console.log("New rows per page:", newPageSize);
          // G·ªçi h√†m render l·∫°i b·∫£ng ho·∫∑c ph√¢n trang t·∫°i ƒë√¢y
          renderTable(newPageSize);
        });
      </script>
      <script>
        document
          .getElementById("saveVehicleBtn")
          .addEventListener("click", function () {
            const licensePlate = document.getElementById("licensePlate").value;
            const model = document.getElementById("vehicleModel").value;
            const status = document.getElementById("vehicleStatus").value;
            if (!licensePlate || !model) {
              alert("Please fill all required fields!");
              return;
            }
            // Ki·ªÉm tra bi·ªÉn s·ªë xe ƒë√£ t·ªìn t·∫°i ch∆∞a
            const exists = vehicleData.some(
              (v) => v.licensePlate === licensePlate
            );
            if (exists) {
              alert("Vehicle with this license plate already exists!");
              return;
            }

            const data = {
              licensePlate: licensePlate,
              model: model,
              status: status,
              isDelete: false,
            };

            fetch("http://localhost:8080/api/vehicles", {
              method: "POST",
              headers: {
                accept: "*/*",
                "Content-Type": "application/json",
                Authorization:
                  "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg"
              },
              body: JSON.stringify(data),
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Network response was not ok");
                }
                return response.json();
              })
              .then((data) => {
                console.log("Success:", data);
                // ƒê√≥ng modal
                const addVehicleModal = bootstrap.Modal.getInstance(
                  document.getElementById("addVehicleModal")
                );
                addVehicleModal.hide();
                // Reset form
                document.getElementById("vehicleForm").reset();
                // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng (n·∫øu mu·ªën)
                alert("Vehicle added successfully!");
                fetchDriverData(); // C·∫≠p nh·∫≠t l·∫°i b·∫£ng sau khi th√™m m·ªõi
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("Failed to add vehicle");
              });
          });
      </script>

      <script>
        let currentPage = 1;
        let rowsPerPage = 10;
        let sortedColumn = null;
        let sortDirection = "asc";

        // Initialize the table
        function initTable() {
          renderTable();
          setupPagination();
          setupSorting();
          updatePageInfo();

          // Rows per page change event
          document
            .getElementById("rowsPerPage")
            .addEventListener("change", function () {
              rowsPerPage = parseInt(this.value);
              currentPage = 1;
              renderTable();
              setupPagination();
              updatePageInfo();
            });
        }

        // Render the table with current page data
        function renderTable() {
          const tableBody = document.getElementById("tableBody");
          tableBody.innerHTML = "";

          // Sort data if needed
          let sortedData = [...vehicleData];
          if (sortedColumn !== null) {
            sortedData.sort((a, b) => {
              const aValue = a[sortedColumn];
              const bValue = b[sortedColumn];

              // Special handling for status to sort by enum order
              if (sortedColumn === "status") {
                const statusOrder = { AVAILABLE: 1, RUNNING: 2, UNAVAILABLE: 3 };
                return (
                  (statusOrder[aValue] - statusOrder[bValue]) *
                  (sortDirection === "asc" ? 1 : -1)
                );
              }

              // Regular text comparison
              return (
                aValue.localeCompare(bValue) * (sortDirection === "asc" ? 1 : -1)
              );
            });
          }

          // Get data for current page
          const startIndex = (currentPage - 1) * rowsPerPage;
          const endIndex = startIndex + rowsPerPage;
          const paginatedData = sortedData.slice(startIndex, endIndex);

          // Create table rows
          paginatedData.forEach((vehicle, index) => {
            const tr = document.createElement("tr");
            const statusClass = `badge-${vehicle.status
              .toLowerCase()
              .replace("_", "-")}`;
            const rowNumber = startIndex + index + 1;

            tr.innerHTML = `
        <td>${vehicle.id}</td>
        <td>${vehicle.licensePlate}</td>
        <td>${vehicle.model}</td>
        <td><span class="badge ${statusClass}">${vehicle.status.replace(
              "_",
              " "
            )}</span></td>
        <td>
          <div class="action justify-content-end">
            
        <button
    class="more-btn ml-10 dropdown-toggle"
    id="moreAction${rowNumber}"
    data-bs-toggle="dropdown"
    aria-expanded="false"
    data-id="${vehicle.licensePlate}"
    style="border: none; background: none;"
  >
    <i class="lni lni-more-alt"></i>
  </button>


            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="moreAction${rowNumber}"
            >
              <li class="dropdown-item">
                <button class="text-gray remove-btn no-radius w-100"
          style="border: none; background: none; box-shadow: none; text-align: left;"
          data-id="${vehicle.id}"
          onclick="removeVehicle(event, '${vehicle.id}')">
    Remove
  </button>


              </li>
              <li class="dropdown-item">
                <button class="text-gray edit-btn no-radius w-100"
          style="border: none; background: none; box-shadow: none; text-align: left;"
          data-id="${vehicle.id}"
          onclick="editVehicle(event, '${vehicle.id}')">
    Edit
  </button>

              </li>
            </ul>
          </div>
        </td>
      `;
            tableBody.appendChild(tr);
          });

          // Add event listeners for action buttons
          addActionEventListeners();
        }

        function addActionEventListeners() {
          // Edit button click
          // document.querySelectorAll(".edit").forEach((button) => {
          //   button.addEventListener("click", (e) => {
          //     const vehicleid = e.currentTarget.getAttribute("data-id");
          //     editVehicle(vehicleid);
          //   });
          // });
          // Remove button click
          // document.querySelectorAll(".remove-btn").forEach((button) => {
          //   button.addEventListener("click", (e) => {
          //     e.preventDefault();
          //     console.log("Remove button clicked");
          //     // const licensePlate = e.currentTarget.getAttribute("data-id");
          //     // removeVehicle(licensePlate);
          //   });
          // });
          // Edit from dropdown click
          // document.querySelectorAll(".edit-btn").forEach((button) => {
          //   button.addEventListener("click", (e) => {
          //     e.preventDefault();
          //     const licensePlate = e.currentTarget.getAttribute("data-id");
          //     editVehicle(licensePlate);
          //   });
          // });
        }

        // function editVehicle(e, licensePlate) {
        //   e.preventDefault();

        //   const vehicle = vehicleData.find(
        //     (v) => v.licensePlate === licensePlate
        //   );

        //   if (vehicle) {
        //     const addVehicleModal = new bootstrap.Modal(
        //       document.getElementById("addVehicleModal")
        //     );
        //     const modalTitle = document.querySelector(
        //       "#addVehicleModal .modal-title"
        //     );
        //     const saveVehicleBtn = document.getElementById("saveVehicleBtn");
        //     const vehicleForm = document.getElementById("vehicleForm");

        //     // ƒê·∫∑t ti√™u ƒë·ªÅ v√† n√∫t
        //     modalTitle.textContent = "Edit Vehicle";
        //     saveVehicleBtn.textContent = "Update";

        //     // ƒêi·ªÅn d·ªØ li·ªáu v√†o form
        //     document.getElementById("id").value = vehicle.id;
        //     document.getElementById("licensePlate").value = vehicle.licensePlate;
        //     document.getElementById("vehicleModel").value = vehicle.model;
        //     document.getElementById("vehicleStatus").value = vehicle.status;

        //     // Hi·ªÉn th·ªã modal
        //     addVehicleModal.show();

        //     // G·∫Øn c·ªù edit mode
        //     isEditMode = true;
        //     currentLicensePlate = vehicle.licensePlate;

        //     // X·ª≠ l√Ω n√∫t save/update (ch·ªâ set l·∫°i handler m·ªôt l·∫ßn)
        //     saveVehicleBtn.onclick = function () {
        //       const newLicensePlate = document
        //         .getElementById("licensePlate")
        //         .value.trim();
        //       const newModel = document
        //         .getElementById("vehicleModel")
        //         .value.trim();
        //       const newStatus = document.getElementById("vehicleStatus").value;

        //       if (!newLicensePlate || !newModel) {
        //         alert("Please fill all required fields!");
        //         return;
        //       }

        //       // Khi edit th√¨ kh√¥ng check tr√πng
        //       const index = vehicleData.findIndex(
        //         (v) => v.licensePlate === currentLicensePlate
        //       );
        //       if (index !== -1) {
        //         // C·∫≠p nh·∫≠t th√¥ng tin c·ªßa vehicle
        //         vehicleData[index] = {
        //           licensePlate: newLicensePlate, // Ch·ªâ thay ƒë·ªïi bi·ªÉn s·ªë n·∫øu c√≥ thay ƒë·ªïi
        //           model: newModel,
        //           status: newStatus,
        //         };
        //         alert("Vehicle updated successfully!");
        //       }

        //       // ƒê√≥ng modal v√† reset form
        //       addVehicleModal.hide();
        //       vehicleForm.reset();
        //       isEditMode = false;
        //       currentLicensePlate = null;

        //       renderTable(); // C·∫≠p nh·∫≠t l·∫°i b·∫£ng sau khi thay ƒë·ªïi
        //       setupPagination();
        //       updatePageInfo();
        //     };
        //   } else {
        //     alert("Vehicle not found!");
        //   }
        // }
        async function editVehicle(event, vehicleId) {
          event.preventDefault();

          try {
            // Fetch vehicle data
            const response = await fetch(
              `http://localhost:8080/api/vehicles/${vehicleId}`,
              {
                method: "GET",
                headers: {
                  accept: "*/*",
                  Authorization:
                    "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg"
                },
              }
            );

            if (!response.ok) {
              throw new Error("Failed to fetch vehicle data");
            }

            const vehicleData = await response.json();

            // Populate the edit form
            document.getElementById("vehicleId").value = vehicleData.id;

            document.getElementById("editVehicleId").value = vehicleData.id;
            document.getElementById("editLicensePlate").value =
              vehicleData.licensePlate;
            document.getElementById("editVehicleModel").value = vehicleData.model;
            document.getElementById("editVehicleStatus").value =
              vehicleData.status;

            // Show the modal
            const editModal = new bootstrap.Modal(
              document.getElementById("editVehicleModal")
            );
            editModal.show();
          } catch (error) {
            console.error("Error fetching vehicle data:", error);
            alert("Failed to load vehicle data for editing");
          }
        }

        // Handle update button click
        document
          .getElementById("updateVehicleBtn")
          .addEventListener("click", async function () {
            const vehicleId = document.getElementById("editVehicleId").value;

            const updatedData = {
              id: document.getElementById("vehicleId").value,
              licensePlate: document.getElementById("editLicensePlate").value,
              model: document.getElementById("editVehicleModel").value,
              status: document.getElementById("editVehicleStatus").value,
              isDelete: "false",
            };

            try {
              const response = await fetch(
                `http://localhost:8080/api/vehicles/${vehicleId}`,
                {
                  method: "PUT", // or 'PATCH' depending on your API
                  headers: {
                    accept: "*/*",
                    Authorization:
                      "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg",
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(updatedData),
                }
              );

              if (!response.ok) {
                throw new Error("Failed to update vehicle");
              }

              // Close the modal and refresh the data
              const editModal = bootstrap.Modal.getInstance(
                document.getElementById("editVehicleModal")
              );
              editModal.hide();

              // Refresh your vehicle list here
              alert("Vehicle updated successfully");
              // You might want to call a function to refresh the vehicle list
              fetchDriverData(); // Assuming this function fetches the updated vehicle data
            } catch (error) {
              console.error("Error updating vehicle:", error);
              alert("Failed to update vehicle");
            }
          });

        function removeVehicle(e, licensePlate) {
          // Confirm before removing
          console.log("Remove button clicked", licensePlate);
          e.preventDefault();
          if (
            confirm(`Are you sure you want to remove vehicle ${licensePlate}?`)
          ) {
            // G·ªçi API DELETE
            fetch(`http://localhost:8080/api/vehicles/${licensePlate}`, {
              method: "DELETE",
              headers: {
                accept: "*/*",
                Authorization:
                  "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg"
              },
            })
              .then((response) => {
                if (response.status === 200 || response.status === 204) {
                  // Xo√° kh·ªèi m·∫£ng local n·∫øu API xo√° th√†nh c√¥ng
                  const index = vehicleData.findIndex(
                    (v) => v.licensePlate === licensePlate
                  );
                  if (index !== -1) {
                    vehicleData.splice(index, 1);
                  }
                  // T√≠nh l·∫°i t·ªïng s·ªë trang
                  const totalPages = Math.ceil(vehicleData.length / pageSize);

                  // Gi·∫£m currentPage n·∫øu v∆∞·ª£t qu√° t·ªïng s·ªë trang
                  if (currentPage > totalPages) {
                    currentPage = totalPages;
                  }
                  fetchDriverData();

                  // renderTable();
                  // setupPagination();
                  // updatePageInfo();
                } else {
                  console.error("Failed to delete vehicle on server");
                  alert("Failed to delete vehicle on server");
                }
              })
              .catch((error) => {
                console.error("Error during delete request:", error);
                alert("Error connecting to server");
              });
          }
        }

        // Setup pagination buttons
        function setupPagination() {
          const pagination = document.getElementById("pagination");
          pagination.innerHTML = "";

          const pageCount = Math.ceil(vehicleData.length / rowsPerPage);

          // Previous button
          const prevLi = document.createElement("li");
          prevLi.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
          prevLi.innerHTML = `<a class="page-link" href="#">Previous</a>`;
          prevLi.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentPage > 1) {
              currentPage--;
              renderTable();
              setupPagination();
              updatePageInfo();
            }
          });
          pagination.appendChild(prevLi);

          // Page buttons
          const maxVisiblePages = 5;
          let startPage = Math.max(
            1,
            currentPage - Math.floor(maxVisiblePages / 2)
          );
          let endPage = Math.min(pageCount, startPage + maxVisiblePages - 1);

          if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
          }

          if (startPage > 1) {
            const firstLi = document.createElement("li");
            firstLi.className = "page-item";
            firstLi.innerHTML = `<a class="page-link" href="#">1</a>`;
            firstLi.addEventListener("click", (e) => {
              e.preventDefault();
              currentPage = 1;
              renderTable();
              setupPagination();
              updatePageInfo();
            });
            pagination.appendChild(firstLi);

            if (startPage > 2) {
              const ellipsisLi = document.createElement("li");
              ellipsisLi.className = "page-item disabled";
              ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
              pagination.appendChild(ellipsisLi);
            }
          }

          for (let i = startPage; i <= endPage; i++) {
            const li = document.createElement("li");
            li.className = `page-item ${i === currentPage ? "active" : ""}`;
            li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            li.addEventListener("click", (e) => {
              e.preventDefault();
              currentPage = i;
              renderTable();
              setupPagination();
              updatePageInfo();
            });
            pagination.appendChild(li);
          }

          if (endPage < pageCount) {
            if (endPage < pageCount - 1) {
              const ellipsisLi = document.createElement("li");
              ellipsisLi.className = "page-item disabled";
              ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
              pagination.appendChild(ellipsisLi);
            }

            const lastLi = document.createElement("li");
            lastLi.className = "page-item";
            lastLi.innerHTML = `<a class="page-link" href="#">${pageCount}</a>`;
            lastLi.addEventListener("click", (e) => {
              e.preventDefault();
              currentPage = pageCount;
              renderTable();
              setupPagination();
              updatePageInfo();
            });
            pagination.appendChild(lastLi);
          }

          // Next button
          const nextLi = document.createElement("li");
          nextLi.className = `page-item ${
            currentPage === pageCount ? "disabled" : ""
          }`;
          nextLi.innerHTML = `<a class="page-link" href="#">Next</a>`;
          nextLi.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentPage < pageCount) {
              currentPage++;
              renderTable();
              setupPagination();
              updatePageInfo();
            }
          });
          pagination.appendChild(nextLi);
        }

        // Update page information text
        function updatePageInfo() {
          const startIndex = (currentPage - 1) * rowsPerPage + 1;
          const endIndex = Math.min(
            currentPage * rowsPerPage,
            vehicleData.length
          );
          const totalItems = vehicleData.length;

          document.getElementById(
            "pageInfo"
          ).textContent = `${startIndex}-${endIndex} of ${totalItems}`;
        }

        // Setup column sorting
        function setupSorting() {
          document
            .querySelectorAll("#vehicleTable thead th")
            .forEach((header, index) => {
              const columns = ["no", "licensePlate", "model", "status"];
              const columnName = columns[index];

              header.addEventListener("click", () => {
                // Clear all sorting classes
                document
                  .querySelectorAll("#vehicleTable thead th")
                  .forEach((th) => {
                    th.classList.remove("asc", "desc", "sorting");
                  });

                // Add appropriate classes to clicked header
                header.classList.add("sorting");

                if (sortedColumn === columnName) {
                  // Reverse sort direction if clicking the same column
                  sortDirection = sortDirection === "asc" ? "desc" : "asc";
                } else {
                  // New column, default to ascending
                  sortedColumn = columnName;
                  sortDirection = "asc";
                }

                header.classList.add(sortDirection);

                // Re-render table with sorted data
                currentPage = 1;
                renderTable();
                setupPagination();
                updatePageInfo();
              });
            });
        }

        // Initialize the table when DOM is loaded
        document.addEventListener("DOMContentLoaded", initTable);
      </script>

      <script>
        fetch("sidebar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("sidebar").innerHTML = data;

            // Sau khi load sidebar xong, g·∫Øn class 'active' cho link ƒë√∫ng
            const currentPage = window.location.pathname.split("/").pop();
            const navLinks = document.querySelectorAll("#sidebar .nav-item a");

            navLinks.forEach((link) => {
              const linkPage = link.getAttribute("href");
              if (linkPage === currentPage) {
                link.parentElement.classList.add("active");
              }
            });
          })
          .catch((error) => {
            console.error("Failed to load sidebar:", error);
          });
      </script>
    <script>
      fetch("header.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("header").innerHTML = data;

          // Sau khi HTML ƒë√£ ƒë∆∞·ª£c g·∫Øn v√†o DOM, b√¢y gi·ªù m·ªõi t√¨m ƒë∆∞·ª£c
          const notiButton = document.getElementById("notification");

          if (notiButton) {
            console.log("‚úÖ ƒê√£ t√¨m th·∫•y n√∫t notification");
            notiButton.addEventListener("click", () => {
              console.log("üöÄ N√∫t notification ƒë∆∞·ª£c b·∫•m!");
              const spanElement = document.querySelector("#notification span");
              spanElement.style.display = "none";
              console.log("üöÄ spanElement:", spanElement);
            });
          } else {
            console.warn("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y n√∫t notification");
          }
        })
        .catch((error) => console.error("‚ùå Failed to load header:", error));
    </script>
    <script src="noti.js"></script>
    <script>
      document.addEventListener("notiDataLoaded", function () {
        console.log("Data loaded:", window.notiData);
      });
    </script>
    <script>
      function getThumbnailUrl(originalUrl) {
        if (!originalUrl) return "assets/images/client-profile.png";
        const idMatch = originalUrl.match(/id=([^&]+)/);
        if (!idMatch) return "assets/images/client-profile.png";
        const fileId = idMatch[1];
        return `https://drive.google.com/thumbnail?id=${fileId}&sz=w50`;
      }

      function formatTimestamp(timestamp) {
        if (!timestamp) return "Just now";
        const date = new Date(timestamp);
        const hours = String(date.getHours()).padStart(2, "0");
        const minutes = String(date.getMinutes()).padStart(2, "0");
        const seconds = String(date.getSeconds()).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${hours}:${minutes}:${seconds} ${day}/${month}/${year}`;
      }

      function initializeNotifications() {
        const notificationList = document.querySelector(".dropdown-menu.notification-dropdown");
        if (!notificationList) {
          console.error("Notification dropdown not found");
          return;
        }

        // Clear old notifications
        notificationList.innerHTML = "";

        // Check if notiData exists
        if (!window.notiData || !Array.isArray(window.notiData)) {
          console.error("No notification data available");
          return;
        }

        // Loop over notiData and generate HTML
        window.notiData.forEach((item) => {
          if (!item) return;

          let content = "";
          if (item.type === "ALCOHOL") {
            content = `Alcohol value: ${item.value || 'N/A'}`;
          } else if (item.type === "DROWSINESS") {
            content = "Driver drowsiness detected.";
          } else {
            content = item.type || "Unknown notification";
          }

          const li = document.createElement("li");
          li.innerHTML = `
            <div class="notification-item unread">
              <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex">
                  <div class="image">
                    <img src="${getThumbnailUrl(item.driver?.faceData)}" alt="Driver" />
                  </div>
                  <div class="content">
                    <h6>${item.driver?.name || 'Unknown Driver'}</h6>
                    <p>${content}</p>
                    <span>${formatTimestamp(item.timestamp)}</span>
                  </div>
                </div>
                <i class="lni lni-checkmark-circle mark-read-btn" 
                   style="cursor: pointer; color: #4A6CF7; font-size: 24px; padding: 8px; transition: all 0.3s ease;" 
                   data-id="${item.id}"></i>
              </div>
            </div>
          `;
          notificationList.appendChild(li);

          // Add click handler for the mark as read icon
          const markReadBtn = li.querySelector('.mark-read-btn');
          if (markReadBtn) {
            markReadBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              const notificationId = this.getAttribute('data-id');
              if (notificationId) {
                markAsRead(notificationId);
                this.style.transform = 'scale(1.2)';
                this.style.color = '#2ecc71';
                setTimeout(() => {
                  this.style.transform = 'scale(1)';
                }, 300);
              }
            });
          }
        });
      }

      // Initialize notifications when data is loaded
      document.addEventListener("notiDataLoaded", function () {
        console.log("Notification data loaded:", window.notiData);
        initializeNotifications();
      });

      // Also initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", function() {
        if (window.notiData) {
          initializeNotifications();
        }
      });
    </script>

    <script>
      // Function to mark all notifications as read
      function markAllAsRead() {
        fetch('http://localhost:8080/api/notifications/read-all', {
          method: 'PUT',
          headers: {
            'Authorization': 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg'
          }
        })
        .then(response => {
          if (response.ok) {
            // Remove unread class from all notifications
            document.querySelectorAll('.notification-item.unread').forEach(item => {
              item.classList.remove('unread');
            });
            // Disable the mark all as read button
            const markAllReadBtn = document.querySelector('.mark-all-read-btn');
            markAllReadBtn.disabled = true;
            markAllReadBtn.classList.add('disabled');
          }
        })
        .catch(error => console.error('Error marking all notifications as read:', error));
      }
    </script>

    <script>
      // Update the markAsRead function to handle icon styling
      function markAsRead(notificationId) {
        fetch(`http://localhost:8080/api/violations/${notificationId}/mark-as-read`, {
          method: 'PATCH',
          headers: {
            'Authorization': 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg'
          }
        })
        .then(response => {
          if (response.ok) {
            // Find the notification item
            const notificationItem = document.querySelector(`.mark-read-btn[data-id="${notificationId}"]`).closest('.notification-item');
            
            // Add fade-out animation
            notificationItem.style.transition = 'all 0.5s ease';
            notificationItem.style.opacity = '0';
            notificationItem.style.transform = 'translateX(100%)';
            
            // Remove the element after animation completes
            setTimeout(() => {
              notificationItem.parentElement.remove();
            }, 500);
          } else {
            console.error('Failed to mark violation as read');
          }
        })
        .catch(error => console.error('Error marking violation as read:', error));
      }
    </script>

      <script>
        // X·ª≠ l√Ω modal th√™m m·ªõi vehicle
        document.addEventListener("DOMContentLoaded", function () {
          const addVehicleModal = new bootstrap.Modal(
            document.getElementById("addVehicleModal")
          );

          // X·ª≠ l√Ω khi nh·∫•n n√∫t Save
          document
            .getElementById("saveVehicleBtn")
            .addEventListener("click", function () {
              const licensePlate = document.getElementById("licensePlate").value;
              const model = document.getElementById("vehicleModel").value;
              const status = document.getElementById("vehicleStatus").value;

              if (!licensePlate || !model) {
                alert("Please fill all required fields!");
                return;
              }

              // Ki·ªÉm tra bi·ªÉn s·ªë xe ƒë√£ t·ªìn t·∫°i ch∆∞a
              const exists = vehicleData.some(
                (v) => v.licensePlate === licensePlate
              );
              if (exists) {
                alert("Vehicle with this license plate already exists!");
                return;
              }

              // Th√™m vehicle m·ªõi v√†o ƒë·∫ßu m·∫£ng
              // vehicleData.unshift({
              //   licensePlate: licensePlate,
              //   model: model,
              //   status: status,
              // });
              vehicleData.push({
                licensePlate: licensePlate,
                model: model,
                status: status,
              });

              // ƒê√≥ng modal
              addVehicleModal.hide();

              // Reset form
              document.getElementById("vehicleForm").reset();

              // C·∫≠p nh·∫≠t b·∫£ng
              currentPage = 1;
              renderTable();
              setupPagination();
              updatePageInfo();

              alert("Vehicle added successfully!");
            });

          // Reset form khi modal ƒë√≥ng
          document
            .getElementById("addVehicleModal")
            .addEventListener("hidden.bs.modal", function () {
              document.getElementById("vehicleForm").reset();
            });
        });
      </script>
      <script>
        // Fetch driver data from API
        function fetchDriverData() {
          fetch("http://localhost:8080/api/vehicles", {
            method: "GET",
            mode: "cors", // Th√™m mode cors
            headers: {
              accept: "*/*",
              Authorization:
                "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0OTczOTY0MiwiYXV0aCI6IlJPTEVfQURNSU4gUk9MRV9VU0VSIiwiaWF0IjoxNzQ3MTQ3NjQyfQ.BN2XTQYoI8ud10u3fzbymFMaaL8na33JW83ic_8Trh0Mo4lcZ5UJOH61pb_fchDBtDp72YzQeITMwSRuRQEzfg"
            },
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Failed to fetch driver data");
              }
              return response.json();
            })
            .then((data) => {
              console.log("Driver data:", data);
              // Replace vehicleData with the fetched data
              vehicleData = data;
              const totalPages = Math.ceil(vehicleData.length / pageSize);
              if (currentPage > totalPages) {
                currentPage = totalPages;
              }
              renderTable(); // Re-render the table with new data
              setupPagination(); // Re-setup pagination
              updatePageInfo(); // Update page info
            })
            .catch((error) => {
              console.error("Error fetching driver data:", error);
            });
        }

        // Call the fetchDriverData function when the page loads
        document.addEventListener("DOMContentLoaded", fetchDriverData);
      </script>
    </body>
  </html>
